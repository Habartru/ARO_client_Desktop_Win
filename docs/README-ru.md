# ARO Client: запуск на Windows (One-Click)

Этот набор скриптов позволяет развернуть и запустить ARO Client (ISO-образ) в виртуальной машине на Windows 10/11.
Сценарий максимально автоматизирован: автоопределение ресурсов, выбор гипервизора, автозагрузка/проверка ISO, автозапуск VM и открытие консоли.

## Возможности
- Автоопределение ресурсов (vCPU / RAM / Disk) по параметрам хоста.
- Пресеты: `auto`, `lite`, `standard`, `perf` (выбор в интерактивном меню батника).
- Приоритет: Hyper‑V (если доступен), иначе — VirtualBox.
- Автозагрузка ISO при отсутствии/повреждении (через BITS/Invoke-WebRequest) и проверка читаемости (Mount-DiskImage).
- Автоотключение ISO после обнаружения установленной ОС на VHDX и установка загрузки с диска.
- Автооткрытие консоли Hyper‑V (`vmconnect.exe`) после старта VM.
- Лог транскрипта: `logs/setup-YYYYMMDD-HHMMSS.log`.

## Структура проекта
- `Run-Me-AroClient.bat` — лаунчер с правами администратора и интерактивным меню пресетов.
- `scripts/Setup-AroClient.ps1` — оркестратор (автонастройки, проверка ISO, выбор Hyper‑V/VBox, логи).
- `scripts/HyperV-Create-VM.ps1` — создание/обновление/старт VM в Hyper‑V, авто‑ISO detach.
- `scripts/VBox-Create-VM.ps1` — создание/обновление/старт VM в VirtualBox.
- `vm/` — файлы виртуальной машины (VHDX/VDI).
- `logs/` — логи сценария.

## Быстрый старт
1) Запустите `Run-Me-AroClient.bat` (двойной клик). Подтвердите UAC.
2) Выберите пресет (или Enter для `auto`).
3) Скрипт:
   - Скачает и проверит ISO при необходимости;
   - Подберёт ресурсы и создаст/обновит VM `ARO-Client`;
   - Запустит VM и откроет консоль Hyper‑V (если используется Hyper‑V).
4) В окне консоли выполните установку/инициализацию ARO Client по документации: https://docs.aro.network/user-guides/software-setup/

После установки скрипт на следующих запусках обнаружит файловую систему на диске VHDX, автоматически отключит ISO и выставит загрузку с диска.

## Пресеты и автонастройка
- Пресеты задаются в меню батника или переменной окружения `ARO_PRESET` (auto|lite|standard|perf).
- Автонастройка учитывает:
  - Кол-во логических потоков CPU;
  - Общий объём RAM;
  - Свободное место на системном SSD (`C:` по умолчанию);
  - Скорость активного физического сетевого адаптера (100 Mb/s, 1 Gb/s, 10 Gb/s и т.д.).
- Скрипт оставляет запас для хоста (минимум 2 потока CPU и 8 ГБ RAM, и ≥20 ГБ свободного места на SSD сверх выделенного).

## Сеть
- Hyper‑V: используется `Default Switch` (NAT). При отсутствии создаётся внутренний vSwitch с NAT (`ARO-NAT-Switch`).
- VirtualBox: при наличии — мостовой адаптер; иначе NAT.
- Для требований ARO (TCP 80/443/9500–9700 и UDP: все) может потребоваться внешний vSwitch или корректная настройка маршрутизатора/NAT.

## Управление VM (Hyper‑V)
- Запуск: `Start-VM -Name "ARO-Client"`
- Остановка: `Stop-VM -Name "ARO-Client" -TurnOff -Force`
- Консоль: `vmconnect.exe localhost "ARO-Client"`
- Отключить ISO вручную: `Set-VMDvdDrive -VMName "ARO-Client" -Path $null`
- Установить загрузку с диска: `Set-VMFirmware -VMName "ARO-Client" -FirstBootDevice (Get-VMHardDiskDrive -VMName "ARO-Client")`

## Логи
- Путь: `logs/setup-YYYYMMDD-HHMMSS.log` (PowerShell Transcript).
- В случае ошибок смотрите также: сообщение в батнике и консольные предупреждения.

## Неисправности и решения
- ISO битый/не читается: скрипт сообщит и предложит перекачать. Проверьте соединение/антивирус/диск.
- Hyper‑V недоступен: включите роль Hyper‑V на Windows Pro/Enterprise и перезагрузите.
- VirtualBox медленный при включённом Hyper‑V: особенность Windows Hypervisor Platform.
- Нет интернета в VM (Hyper‑V NAT): переподключите к `Default Switch` или настройте внешний vSwitch.

## Примечания
- ARO Client официально распространяется как ISO для x86 VM. Docker не является целевым способом запуска на Windows.
- Производительность зависит от ресурсов хоста и сети. При просадках снизьте пресет (lite/standard).
